<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdn.tailwindcss.com https://unpkg.com https://fonts.googleapis.com https://fonts.gstatic.com https://media1.tenor.com;">
    <title>VeloVenture - Story Configurator</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18.3.1/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone@7.24.4/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }

        .animate-slideUp {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes fadeInComponent {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .animate-fadeInComponent {
            animation: fadeInComponent 0.4s ease-out forwards;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 to-slate-200 min-h-screen text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- ICONS ---
        const IconZap = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></svg>;
        const IconShield = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>;
        const IconBattery = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="1" y="6" width="18" height="12" rx="2" ry="2" /><line x1="23" y1="13" x2="23" y2="11" /></svg>;
        const IconAward = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></svg>;
        const IconTrendingUp = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></svg>;
        const IconBike = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="5.5" cy="17.5" r="3.5" /><circle cx="18.5" cy="17.5" r="3.5" /><path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-3 11.5V14l-3-3 4-3 2 3h2" /></svg>;
        const IconRefresh = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M23 4v6h-6" /><path d="M1 20v-6h6" /><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" /></svg>;
        const IconSettings = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;

        // --- DATEN ---
        const archetypes = [
            {
                id: 'commuter',
                title: 'Der Stadt-Ninja',
                desc: 'Asphalt ist dein Revier. Du brauchst Speed und Agilität zwischen Autos.',
                iconComponent: IconZap,
                iconColor: "text-blue-500",
                baseStats: { price: 2000, weight: 15, range: 40, agility: 80 }
            },
            {
                id: 'explorer',
                title: 'Der Alpen-Bezwinger',
                desc: 'Kein Berg ist zu hoch. Du suchst Schotter, Schlamm und Freiheit.',
                iconComponent: IconShield,
                iconColor: "text-green-500",
                baseStats: { price: 2800, weight: 22, range: 60, agility: 50 }
            }
        ];

        const storyNodes = [
            {
                id: 1,
                text: "Der Morgen graut, die Stadt erwacht. Du stehst vor deinem Bike, bereit für den Tag. Heute liegt eine besondere Energie in der Luft. Wie möchtest du dich auf deinem Weg fühlen?",
                options: [
                    {
                        text: "Wie ein Blitz! Ich will jeden Ampelsprint gewinnen und den Fahrtwind im Gesicht spüren.",
                        effect: { component: 'Motor', name: 'HyperDrive X', price: 500, range: -10, weight: 2, tag: 'speed' }
                    },
                    {
                        text: "Im Zen-Modus. Ich möchte lautlos durch die Straßen gleiten, eins mit der Umgebung.",
                        effect: { component: 'Motor', name: 'EcoCruise 2.0', price: 200, range: +20, weight: 0, tag: 'eco' }
                    }
                ]
            },
            {
                id: 2,
                text: "Dein Weg führt dich unerwartet an den rauen Rand der Stadt. Der Untergrund wechselt plötzlich: Altes Kopfsteinpflaster, dann loser Schotter und Pfützen.",
                options: [
                    {
                        text: "Ich will wie auf Wolken fahren. Maximale Sicherheit und Grip, egal was kommt.",
                        effect: { component: 'Reifen', name: 'GripMaster All-Weather', price: 150, range: -5, weight: 1, tag: 'safe' }
                    },
                    {
                        text: "Ich liebe das direkte Feedback der Straße. Ich weiche auf den Asphalt aus – schnell und hart.",
                        effect: { component: 'Reifen', name: 'SlickRacers', price: 80, range: +5, weight: -1, tag: 'budget' }
                    }
                ]
            },
            {
                id: 3,
                text: "Du blickst auf die Karte. Ein entfernter Aussichtspunkt auf dem Berg lockt dich. Es geht steil bergauf und der Weg ist weit.",
                options: [
                    {
                        text: "Ich nehme die Herausforderung an! Aber ich brauche massive Energiereserven für den ganzen Tag.",
                        effect: { component: 'Akku', name: 'PowerCell 800Wh', price: 600, range: +80, weight: 4, tag: 'range' }
                    },
                    {
                        text: "Ich bleibe lieber agil für den kurvigen Trail hier unten. Weniger Gewicht bedeutet mehr Spaß.",
                        effect: { component: 'Akku', name: 'Compact 400Wh', price: 300, range: +30, weight: 1, tag: 'agile' }
                    }
                ]
            }
        ];

        const ProgressBar = ({ current, total }) => {
            const progress = Math.min(100, Math.max(0, (current / total) * 100));

            return (
                <div className="relative w-full h-12 mb-10 flex items-center">
                    <div className="absolute w-full h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div
                            className="h-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-700 ease-out"
                            style={{ width: `${progress}%` }}
                        />
                    </div>
                    <div
                        className="absolute top-0 transition-all duration-700 ease-out z-10 -mt-4"
                        style={{ left: `calc(${progress}% - 24px)` }}
                    >
                        <div className="bg-white p-1 rounded-full shadow-lg border-2 border-blue-500 transform hover:scale-110 transition-transform w-12 h-12 flex items-center justify-center overflow-hidden">
                            <img src="https://media1.tenor.com/m/AgQlG3sOWBYAAAAC/bike-biking.gif" alt="Cyclist" className="w-full h-full object-cover" />
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const EBikeStoryConfigurator = () => {
            const [step, setStep] = useState(0);
            const [selectedArchetype, setSelectedArchetype] = useState(null);
            const [config, setConfig] = useState({
                components: [],
                stats: { price: 0, weight: 0, range: 0, agility: 0 },
                tags: []
            });
            const [selectedOption, setSelectedOption] = useState(null);

            const resetConfig = () => {
                setStep(0);
                setSelectedArchetype(null);
                setConfig({ components: [], stats: { price: 0, weight: 0, range: 0, agility: 0 }, tags: [] });
                setSelectedOption(null);
            };

            const handleArchetypeSelect = (archetype) => {
                setSelectedArchetype(archetype);
                setConfig({ ...config, stats: { ...archetype.baseStats } });
                setStep(1);
            };

            const updateConfig = (componentType, name, price, weight, range, tag) => {
                setConfig((prev) => ({
                    components: [...prev.components, { type: componentType, name: name }],
                    stats: {
                        price: prev.stats.price + price,
                        weight: prev.stats.weight + weight,
                        range: prev.stats.range + range,
                        agility: prev.stats.agility
                    },
                    tags: [...prev.tags, tag]
                }));
            };

            const handleStoryOptionSelect = (option, idx) => {
                setSelectedOption(idx);
                const effect = option.effect;

                setTimeout(() => {
                    updateConfig(effect.component, effect.name, effect.price, effect.weight, effect.range, effect.tag);

                    if (step < storyNodes.length) {
                        setStep(step + 1);
                        setSelectedOption(null);
                    } else {
                        setStep(4);
                        setSelectedOption(null);
                    }
                }, 3000);
            };

            const getComponentIcon = (type) => {
                switch (type) {
                    case 'Motor': return IconZap;
                    case 'Akku': return IconBattery;
                    case 'Reifen': return IconSettings;
                    default: return IconBike;
                }
            };

            // --- RENDERERS ---
            const RenderIntro = () => (
                <div className="space-y-6 animate-fadeIn text-center max-w-4xl mx-auto mt-10">
                    <h1 className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-teal-500 mb-4">VeloVenture</h1>
                    <p className="text-xl text-gray-600 max-w-2xl mx-auto">Dein Weg zum perfekten eBike. Erlebe deine Geschichte.</p>

                    <div className="flex justify-center mt-16 px-4">
                        <div className="bg-white p-8 rounded-3xl border-2 border-blue-100 hover:border-blue-500 hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 cursor-pointer group relative overflow-hidden max-w-md"
                            onClick={() => handleArchetypeSelect(archetypes[0])}>
                            <div className="absolute top-0 right-0 w-32 h-32 bg-blue-50 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-150"></div>
                            <div className="relative z-10">
                                <div className="w-16 h-16 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <IconBike className="w-8 h-8" />
                                </div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-2">Story Modus</h3>
                                <p className="text-gray-500">Erlebe ein Abenteuer und lass deine Entscheidungen das Bike formen.</p>
                                <div className="mt-6 text-blue-600 font-bold flex items-center justify-center gap-2">
                                    Starten <span className="group-hover:translate-x-1 transition-transform">→</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const RenderStoryStep = () => {
                const node = storyNodes[step - 1];
                return (
                    <div className="max-w-2xl mx-auto space-y-8 animate-slideUp mt-10">
                        <div className="flex justify-between text-xs font-bold text-gray-400 uppercase tracking-widest">
                            <span>Story Mode</span>
                            <span>Kapitel {step} / {storyNodes.length}</span>
                        </div>

                        <ProgressBar current={step} total={storyNodes.length + 1} />

                        <h3 className="text-3xl font-bold text-gray-800 leading-tight">
                            {node.text}
                        </h3>

                        <div className="grid gap-4 mt-8">
                            {node.options.map((opt, idx) => (
                                <button key={idx} onClick={() => handleStoryOptionSelect(opt, idx)}
                                    className="p-6 bg-white border border-gray-200 rounded-xl hover:bg-blue-50 hover:border-blue-500 text-left transition-all duration-200 shadow-sm hover:shadow-md flex items-start gap-4 group"
                                    disabled={selectedOption !== null}>
                                    <div className="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-blue-500 flex-shrink-0 mt-1"></div>
                                    <div className="flex-grow">
                                        <span className="text-lg font-medium text-gray-700 group-hover:text-blue-700 block mb-3">{opt.text}</span>
                                        {selectedOption === idx && (
                                            <div className="text-xs font-bold text-teal-600 bg-teal-50 px-3 py-2 rounded-lg inline-flex items-center gap-2 border border-teal-100 animate-fadeInComponent">
                                                <span className="uppercase tracking-wider text-teal-800">{opt.effect.component}:</span>
                                                <span>{opt.effect.name}</span>
                                            </div>
                                        )}
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            };

            const RenderResult = () => {
                return (
                    <div className="space-y-8 animate-fadeIn max-w-6xl mx-auto mt-6">
                        <div className="text-center space-y-2">
                            <h2 className="text-4xl font-extrabold text-gray-800">
                                Dein <span className="text-blue-600">Ergebnis</span>
                            </h2>
                            <p className="text-gray-500">Konfiguration abgeschlossen</p>
                        </div>

                        <div className="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100 flex flex-col md:flex-row">
                            <div className="w-full md:w-1/2 bg-gray-50 p-6 flex flex-col relative h-[500px] md:h-auto">
                                <div className="absolute top-6 left-6 z-10">
                                    <h3 className="text-2xl font-bold text-gray-800">{selectedArchetype ? selectedArchetype.title : 'Custom Bike'}</h3>
                                    <span className="text-blue-600 font-semibold text-sm">Story Build</span>
                                </div>

                                <div className="flex-grow rounded-2xl overflow-hidden border border-gray-200 shadow-inner bg-white relative flex items-center justify-center p-8">
                                    <img
                                        src={selectedArchetype?.id === 'explorer' ? 'assets/explorer.png' : 'assets/commuter.png'}
                                        alt="Bike Preview"
                                        className="max-w-full max-h-full object-contain hover:scale-105 transition-transform duration-500"
                                    />
                                    <div className="absolute bottom-4 right-4 text-xs text-gray-400 bg-white/80 px-2 py-1 rounded">Generiertes 2D Bild</div>
                                </div>
                            </div>

                            <div className="w-full md:w-1/2 p-8 flex flex-col justify-between">
                                <div>
                                    <h4 className="text-gray-400 text-xs font-bold uppercase tracking-wider mb-4">Verbaute Komponenten</h4>
                                    <div className="space-y-3 mb-8">
                                        {config.components.map((c, i) => {
                                            const CompIcon = getComponentIcon(c.type);
                                            return (
                                                <div key={i} className="flex items-center gap-3 p-3 rounded-xl bg-gray-50 border border-gray-100">
                                                    <div className="p-2 bg-white rounded-lg text-blue-500 shadow-sm">
                                                        <CompIcon className="w-5 h-5" />
                                                    </div>
                                                    <div>
                                                        <div className="text-xs text-gray-400 font-semibold uppercase">{c.type}</div>
                                                        <div className="text-gray-800 font-medium">{c.name}</div>
                                                    </div>
                                                </div>
                                            )
                                        })}
                                    </div>

                                    <div className="grid grid-cols-3 gap-4 mb-8">
                                        <div className="text-center">
                                            <div className="text-xs text-gray-400 font-bold uppercase">Reichweite</div>
                                            <div className="text-xl font-extrabold text-gray-800">{config.stats.range} <span className="text-xs font-normal text-gray-500">km</span></div>
                                        </div>
                                        <div className="text-center border-l border-gray-100">
                                            <div className="text-xs text-gray-400 font-bold uppercase">Gewicht</div>
                                            <div className="text-xl font-extrabold text-gray-800">{config.stats.weight} <span className="text-xs font-normal text-gray-500">kg</span></div>
                                        </div>
                                        <div className="text-center border-l border-gray-100">
                                            <div className="text-xs text-gray-400 font-bold uppercase">Preis</div>
                                            <div className="text-xl font-extrabold text-blue-600">{config.stats.price} €</div>
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <button onClick={resetConfig}
                                        className="w-full py-4 bg-gray-100 text-gray-600 font-bold rounded-xl hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                                        <IconRefresh className="w-4 h-4" /> Neue Konfiguration
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="w-full max-w-6xl mx-auto p-4 md:p-8">
                    {step === 0 && <RenderIntro />}
                    {(step > 0 && step <= 3) && <RenderStoryStep />}
                    {step === 4 && <RenderResult />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EBikeStoryConfigurator />);
    </script>
</body>

</html>